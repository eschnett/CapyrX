# Description

The "Cake" patch system consists of 6 Thornburg-like spherical patches that perfectly match with a central cartesian cube patch, thus having a total of 7 patches.

# Patch naming/indexing convention

Each patch in the cake has a name and index. These are defined [here](https://bitbucket.org/eschnett/cactusamrex/src/d89fc96eaf7dbdf831fc76c0fd3a9df8633ee445/MultiPatch/src/cake/cake.hxx#lines-80:96).

# References

The equations that define this patch system can be found in https://arxiv.org/pdf/gr-qc/0512001.pdf (sec. IV, equations (18)-(19) and unnumbered equations in-between). Other useful references are

1. https://arxiv.org/abs/0712.0353
2. https://arxiv.org/abs/gr-qc/0602104
3. https://arxiv.org/abs/gr-qc/0507004
4. https://arxiv.org/abs/gr-qc/0512001
5. https://arxiv.org/abs/gr-qc/0404059
6. https://arxiv.org/abs/1212.1191
7. https://gwic.ligo.org/assets/docs/theses/reisswig_thesis.pdf
8. https://arxiv.org/abs/0904.0493

# Mathematica Notebooks

Mathematica Notebooks used for visualization and code generation of patches can be found in the [`resources`](resources/) folder.

## Deduction of the coordinate system and mathematical discussions

The notebook [`Cake7_deduction`](resources/Cake7_deductions.nb) contains the deduction of the inverse coordinate system (global to local) as well as a few considerations about the validity of such inverse in the context of ghost zones and the conditions which need to be applied in the outer and iner boundary radii.

## Visualizing the Cake patch system

The notebook [`Cake7_visualize.nb`](resources/Cake7_visualize.nb) allows one to interactively visualize the Cake patch system in 3D by drawing constant `c` coordinate surfaces. To produce and interactive plot, simply evaluate the whole notebook.

## Generating C++ code

Jacobians and their derivatives are auto-generated in this patch system. To generate the source files, evaluate the whole notebook file [`Cake7_jacobians_codegen.nb`](resources/Cake7_jacobians_codegen.nb). The jacobians also require derivates of the "core" function in the global to local coordinate transformations. A file containing the definitions of such derivatives is also auto generated by the notebook [`Cake7_inverse_core_codegen.nb`](resources/Cake7_inverse_core_codegen.nb). Again. to generate the file run the whole notebook.

The file [`cse.m`](resources/cse.m) is a Mathematica module that performs common subexpression elimination (CSE) in Mathematica expressions. Some large expressions use this module to produce better C++ code.